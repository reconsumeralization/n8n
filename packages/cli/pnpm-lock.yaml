import { readFileSync, writeFileSync } from 'fs';
import { safeDump } from 'js-yaml';

const packageJsonPath = 'packages/cli/package.json';
const lockfilePath = 'packages/cli/pnpm-lock.yaml';

// Step 1: Read the contents of the package.json file
const packageJsonData = readFileSync(packageJsonPath, 'utf8');

// Step 2: Parse the JSON data from the package.json file
const { dependencies } = JSON.parse(packageJsonData);

// Step 3: Generate a new lockfile object based on the extracted dependencies and versions
const lockfile = {
  dependencies,
  lockfileVersion: 5,
  registry: 'https://registry.npmjs.org',
};

// Step 4: Convert the lockfile object to YAML format
const lockfileYaml = safeDump(lockfile);

// Step 5: Write the YAML data to the pnpm-lock.yaml file, replacing its existing contents
writeFileSync(lockfilePath, lockfileYaml);
